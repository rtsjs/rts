{"version":3,"sources":["server/client/simulation.ts"],"names":["Cart","Cart.constructor","Cart.integrate","Stick","Stick.constructor","Stick.integrate","Controller","Controller.constructor","Controller.getForce","Pendulum","Pendulum.constructor","Pendulum.knockStick","Pendulum.solve","Pendulum.integrate","Simulation","Simulation.constructor","Simulation.step","Simulation.display","Simulation.start","Simulation.stop"],"mappings":"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","file":"server/client/simulation.js","sourcesContent":["class Cart {\r\n    x_pp : number;\r\n    constructor(public x:number, public x_p:number){\r\n    }\r\n    integrate(t:number){\r\n        this.x = this.x + this.x_p * t + this.x_pp * t * t / 2;\r\n        this.x_p = this.x_p + this.x_pp * t;\r\n    }\r\n}\r\n\r\nclass Stick {\r\n    th_pp: number;\r\n    constructor(public th: number, public th_p: number) {\r\n    }\r\n    integrate(t: number) {\r\n        this.th = this.th + this.th_p * t + this.th_pp * t * t / 2;\r\n        this.th_p = this.th_p + this.th_pp * t;\r\n    }\r\n}\r\nclass Controller {\r\n    constructor(public a: number, public b: number, public c: number, public d:number) {\r\n    }\r\n    getForce(x:number, th:number, x_p:number, th_p:number):number {\r\n        var f = this.a * x + this.b * (th - Math.PI / 2) + this.c * x_p + this.d * th_p;\r\n        return f;\r\n    }\r\n}\r\n\r\nclass Pendulum {\r\n    constructor(public cart:Cart, public stick:Stick) {\r\n    }\r\n\r\n    knockStick(angle: number) {\r\n        this.stick.th -= angle * Math.PI / 180;\r\n    }\r\n        \r\n    solve(f:number){\r\n        var th = this.stick.th;\r\n        var th_p = this.stick.th_p;\r\n\r\n        var co = Math.cos(th);\r\n        var si = Math.sin(th);\r\n        var x_pp = (co * th_p * th_p - 2 * co * si + 2 * f) / (4 - 2 * si * si);\r\n        var th_pp = -2 * co + 2 * si * x_pp;\r\n\r\n        this.cart.x_pp = x_pp;\r\n        this.stick.th_pp = th_pp;\r\n    }\r\n    integrate(t:number){\r\n        this.cart.integrate(t);\r\n        this.stick.integrate(t);\r\n    }\r\n}\r\nclass Simulation {\r\n\r\n    span: HTMLElement;\r\n    timerToken: number;\r\n    timerTokenDisplay: number;\r\n    pendulum: Pendulum\r\n    controller: Controller\r\n    dt: number\r\n\r\n    constructor(public elements: any) {\r\n        //initialization\r\n        this.dt = 0.01;\r\n        var cart = new Cart(0, 0);\r\n        var stick = new Stick(Math.PI / 2, 0);\r\n        this.controller = new Controller(1, -14.8452, 5.97415, -13.7966);\r\n        this.pendulum = new Pendulum(cart, stick); \r\n    }\r\n\r\n    step() {\r\n        var f = this.controller.getForce(this.pendulum.cart.x, this.pendulum.stick.th, this.pendulum.cart.x_p, this.pendulum.stick.th_p);\r\n        //f = 0;\r\n        this.pendulum.solve(f);\r\n        this.pendulum.integrate(this.dt);    \r\n    }\r\n\r\n    display() {\r\n        var thetaAttr = (this.pendulum.stick.th * 180 / Math.PI).toString();\r\n        var xAttr = (this.pendulum.cart.x * 100).toString();\r\n        var xVal = (this.pendulum.cart.x).toString();\r\n        this.elements.thetaValue.innerText = thetaAttr;\r\n        this.elements.xValue.innerText = xVal;\r\n        this.elements.x.setAttribute(\"transform\", \"translate(\" + xAttr + \")\");\r\n        this.elements.theta.setAttribute(\"transform\", \"rotate(\" + thetaAttr + \")\");\r\n    }\r\n\r\n    start() {\r\n        this.pendulum.knockStick(20);\r\n        var t = this.dt*1000;        \r\n        this.timerToken = setInterval(() => { this.step(); }, t);\r\n        this.timerTokenDisplay = setInterval(() => {this.display(); }, 50);\r\n    }\r\n\r\n    stop() {\r\n        clearInterval(this.timerToken);\r\n        clearInterval(this.timerTokenDisplay);\r\n    }\r\n}\r\n\r\nwindow.onload = () => {\r\n    var el1 = document.getElementById('x');\r\n    var el2 = document.getElementById('theta');\r\n    var el3 = document.getElementById('xValue');\r\n    var el4 = document.getElementById('thetaValue');\r\n    var elements = { x: el1, theta: el2, xValue: el3, thetaValue: el4 };\r\n    var simulation = new Simulation(elements);\r\n    simulation.start();\r\n    setTimeout(() => { simulation.stop(); }, 60000);\r\n};"],"sourceRoot":"/source/"}